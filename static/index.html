<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPL Scout Team - Gameweek 1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            position: relative;
        }

        /* Diagonal Watermark - positioned beside Midfielders */
        body::before {
            content: "@elcaiseri";
            position: absolute;
            top: auto;
            left: auto;
            transform: none;
            font-size: 0.9rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.8);
            z-index: 10;
            pointer-events: none;
            white-space: nowrap;
            background: rgba(55, 0, 60, 0.7);
            padding: 4px 8px;
            border-radius: 4px;
            backdrop-filter: blur(2px);
            display: none;
            /* Will be positioned by JavaScript */
        }

        /* Additional watermark for better screenshot visibility */
        body::after {
            content: "@elcaiseri";
            position: fixed;
            bottom: 10px;
            right: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.7);
            z-index: 1000;
            pointer-events: none;
            background: rgba(55, 0, 60, 0.8);
            padding: 4px 8px;
            border-radius: 4px;
            backdrop-filter: blur(2px);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            z-index: 2;
        }

        .header {
            background: linear-gradient(135deg, #37003c 0%, #00ff87 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header .gameweek {
            font-size: 1rem;
            opacity: 0.9;
        }

        .pitch {
            background: linear-gradient(90deg, #228B22 0%, #32CD32 50%, #228B22 100%);
            background-image:
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 15px 15px;
            padding: 20px 15px;
            position: relative;
        }

        .formation-line {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
            gap: 8px;
        }

        .player-card {
            background: white;
            border-radius: 10px;
            padding: 8px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 100px;
            max-width: 130px;
            position: relative;
            border: 2px solid transparent;
            flex: 1;
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .player-card.captain {
            border-color: #FFD700;
            background: linear-gradient(145deg, #fff 0%, #FFF8DC 100%);
        }

        .player-card.vice {
            border-color: #C0C0C0;
            background: linear-gradient(145deg, #fff 0%, #F5F5F5 100%);
        }

        .player-name {
            font-weight: bold;
            font-size: 0.85rem;
            color: #37003c;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .team-name {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .fixture {
            font-size: 0.65rem;
            color: #888;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .expected-points {
            background: #37003c;
            color: white;
            padding: 3px 6px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            display: inline-block;
        }

        .role-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.7rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .role-badge.captain {
            background: #FFD700;
            color: #37003c;
        }

        .role-badge.vice {
            background: #C0C0C0;
            color: #37003c;
        }

        .position-label {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin: 0 auto 15px auto;
            display: block;
            width: fit-content;
            position: relative;
        }

        .position-label.midfielder::after {
            content: "@elcaiseri";
            position: absolute;
            right: -80px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(55, 0, 60, 0.8);
            padding: 3px 6px;
            border-radius: 3px;
            backdrop-filter: blur(2px);
            white-space: nowrap;
        }

        .goalkeeper {
            background: #FF6B35;
        }

        .defender {
            background: #004E98;
        }

        .midfielder {
            background: #3A86FF;
        }

        .forward {
            background: #06FFA5;
        }

        .stats-section {
            padding: 15px 20px;
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #37003c;
        }

        .stat-label {
            color: #666;
            margin-top: 3px;
            font-size: 0.8rem;
        }

        .home-indicator {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-left: 3px;
        }

        .home-indicator.home {
            background: #00ff87;
        }

        .home-indicator.away {
            background: #ff4757;
        }

        .credits {
            text-align: center;
            padding: 10px;
            color: #666;
            font-size: 0.75rem;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            position: relative;
        }

        .credits::after {
            content: "Created by @elcaiseri";
            display: block;
            margin-top: 5px;
            font-weight: bold;
            color: #37003c;
        }

        .loading {
            text-align: center;
            padding: 30px;
            font-size: 1rem;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 30px;
            font-size: 1rem;
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            margin: 20px;
        }

        .gameweek-selector {
            margin: 10px 20px;
            text-align: center;
        }

        .gameweek-selector select {
            padding: 8px 12px;
            border: 2px solid #37003c;
            border-radius: 8px;
            background: white;
            color: #37003c;
            font-size: 1rem;
            cursor: pointer;
            min-width: 150px;
        }

        .screenshot-button {
            background: linear-gradient(135deg, #37003c 0%, #00ff87 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .screenshot-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .screenshot-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .screenshot-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .position-label {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin: 0 auto 15px auto;
            display: block;
            width: fit-content;
            position: relative;
        }

        .position-label.midfielder::after {
            content: "@elcaiseri";
            position: absolute;
            right: -80px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.7rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(55, 0, 60, 0.8);
            padding: 3px 6px;
            border-radius: 3px;
            backdrop-filter: blur(2px);
            white-space: nowrap;
        }

        .goalkeeper {
            background: #FF6B35;
        }

        .defender {
            background: #004E98;
        }

        .midfielder {
            background: #3A86FF;
        }

        .forward {
            background: #06FFA5;
        }

        .stats-section {
            padding: 15px 20px;
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #37003c;
        }

        .stat-label {
            color: #666;
            margin-top: 3px;
            font-size: 0.8rem;
        }

        .home-indicator {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-left: 3px;
        }

        .home-indicator.home {
            background: #00ff87;
        }

        .home-indicator.away {
            background: #ff4757;
        }

        .credits {
            text-align: center;
            padding: 10px;
            color: #666;
            font-size: 0.75rem;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            position: relative;
        }

        .credits::after {
            content: "Created by @elcaiseri";
            display: block;
            margin-top: 5px;
            font-weight: bold;
            color: #37003c;
        }

        .loading {
            text-align: center;
            padding: 30px;
            font-size: 1rem;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 30px;
            font-size: 1rem;
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            margin: 20px;
        }

        .gameweek-selector {
            margin: 10px 20px;
            text-align: center;
        }

        .gameweek-selector select {
            padding: 8px 12px;
            border: 2px solid #37003c;
            border-radius: 8px;
            background: white;
            color: #37003c;
            font-size: 1rem;
            cursor: pointer;
            min-width: 150px;
        }

        .screenshot-button {
            background: linear-gradient(135deg, #37003c 0%, #00ff87 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .screenshot-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .screenshot-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .screenshot-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .position-label {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin: 0 auto 15px auto;
            display: block;
            width: fit-content;
            position: relative;
        }

        .position-label.midfielder::after {
            content: "@elcaiseri";
            position: absolute;
            right: -120px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(55, 0, 60, 0.8);
            padding: 3px 6px;
            border-radius: 3px;
            backdrop-filter: blur(2px);
            white-space: nowrap;
        }

        .goalkeeper {
            background: #FF6B35;
        }

        .defender {
            background: #004E98;
        }

        .midfielder {
            background: #3A86FF;
        }

        .forward {
            background: #06FFA5;
        }

        .stats-section {
            padding: 15px 20px;
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #37003c;
        }

        .stat-label {
            color: #666;
            margin-top: 3px;
            font-size: 0.8rem;
        }

        .home-indicator {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-left: 3px;
        }

        .home-indicator.home {
            background: #00ff87;
        }

        .home-indicator.away {
            background: #ff4757;
        }

        .credits {
            text-align: center;
            padding: 10px;
            color: #666;
            font-size: 0.75rem;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            position: relative;
        }

        .credits::after {
            content: "Created by @elcaiseri";
            display: block;
            margin-top: 5px;
            font-weight: bold;
            color: #37003c;
        }

        .loading {
            text-align: center;
            padding: 30px;
            font-size: 1rem;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 30px;
            font-size: 1rem;
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            margin: 20px;
        }

        .gameweek-selector {
            margin: 10px 20px;
            text-align: center;
        }

        .gameweek-selector select {
            padding: 8px 12px;
            border: 2px solid #37003c;
            border-radius: 8px;
            background: white;
            color: #37003c;
            font-size: 1rem;
            cursor: pointer;
            min-width: 150px;
        }

        .screenshot-button {
            background: linear-gradient(135deg, #37003c 0%, #00ff87 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .screenshot-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .screenshot-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .screenshot-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            body::before {
                font-size: 4rem;
                color: rgba(255, 255, 255, 0.03);
            }

            body::after {
                font-size: 1rem;
                padding: 5px 10px;
            }

            .container {
                border-radius: 10px;
            }

            .header {
                padding: 10px 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header .gameweek {
                font-size: 0.9rem;
            }

            .pitch {
                padding: 15px 10px;
            }

            .formation-line {
                gap: 5px;
                margin: 10px 0;
            }

            .player-card {
                min-width: 80px;
                max-width: 110px;
                padding: 6px;
            }

            .player-name {
                font-size: 0.75rem;
            }

            .team-name {
                font-size: 0.65rem;
            }

            .fixture {
                font-size: 0.6rem;
            }

            .expected-points {
                font-size: 0.7rem;
                padding: 2px 5px;
            }

            .position-label {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .position-label.midfielder::after {
                right: -70px;
                font-size: 0.6rem;
                padding: 2px 5px;
            }

            .stats-section {
                padding: 10px 15px;
            }

            .stats-grid {
                gap: 8px;
            }

            .stat-card {
                padding: 8px;
            }

            .stat-value {
                font-size: 1.1rem;
            }

            .stat-label {
                font-size: 0.75rem;
            }

            .role-badge {
                width: 18px;
                height: 18px;
                font-size: 0.65rem;
                top: -6px;
                right: -6px;
            }

            .gameweek-selector {
                margin: 5px 10px;
            }

            .gameweek-selector select {
                font-size: 0.9rem;
                min-width: 120px;
            }

            .screenshot-button {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
                max-width: 200px;
            }

            .screenshot-controls {
                flex-direction: column;
            }
        }

        /* Extra small mobile screens */
        @media (max-width: 480px) {
            body::before {
                font-size: 3rem;
                color: rgba(255, 255, 255, 0.025);
            }

            body::after {
                font-size: 0.9rem;
                padding: 4px 8px;
            }

            .formation-line {
                gap: 3px;
            }

            .player-card {
                min-width: 70px;
                max-width: 90px;
                padding: 4px;
            }

            .player-name {
                font-size: 0.7rem;
            }

            .team-name {
                font-size: 0.6rem;
            }

            .fixture {
                font-size: 0.55rem;
            }

            .expected-points {
                font-size: 0.65rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }

            .stat-value {
                font-size: 1rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }

            .position-label.midfielder::after {
                right: -60px;
                font-size: 0.55rem;
                padding: 2px 4px;
            }
        }

        /* Print styles for screenshots */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                border: 1px solid #ddd;
            }

            .player-card:hover {
                transform: none;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            }

            .gameweek-selector {
                display: none;
            }

            body::before {
                color: rgba(0, 0, 0, 0.03) !important;
            }

            body::after {
                color: rgba(55, 0, 60, 0.9) !important;
                background: rgba(255, 255, 255, 0.95) !important;
                border: 1px solid rgba(55, 0, 60, 0.3);
            }

            .credits::after {
                color: #37003c !important;
                font-weight: bold !important;
            }
        }

        /* Ensure single page fit */
        .single-page {
            max-height: 100vh;
            overflow: hidden;
        }

        @media (max-height: 800px) {
            .pitch {
                padding: 10px;
            }

            .formation-line {
                margin: 8px 0;
            }

            .stats-section {
                padding: 10px 15px;
            }

            .header {
                padding: 10px 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container single-page">
        <div class="header">
            <h1>OpenFPL Scout AI Team</h1>
            <div class="gameweek" id="gameweek-info">Loading...</div>
        </div>

        <div class="gameweek-selector">
            <label for="gameweek-select">Select Gameweek:</label>
            <div class="screenshot-controls">
                <select id="gameweek-select">
                    <option value="">Loading gameweeks...</option>
                </select>
                <button id="screenshot-btn" class="screenshot-button" onclick="takeScreenshot()">
                    📸 Screenshot
                </button>
            </div>
            <div class="stats-section">
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-points">-</div>
                        <div class="stat-label">Total Expected Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="player-count">-</div>
                        <div class="stat-label">Players Selected</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="pitch" id="pitch">
            <div class="loading">Loading team data...</div>
        </div>



        <div class="credits" id="credits">
            Loading...
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            dataPath: 'data/internal/scout_team/',
            filePrefix: 'gw_',
            fileExtension: '.json',
            maxGameweeks: 38,
            defaultGameweek: 38
        };

        // State management
        let currentGameweek = CONFIG.defaultGameweek;
        let availableGameweeks = [];

        // Function to create player card HTML
        function createPlayerCard(player) {
            const roleClass = player.role === "captain" ? "captain" : player.role === "vice" ? "vice" : "";
            const roleBadge = player.role === "captain" ? '<div class="role-badge captain">C</div>' :
                player.role === "vice" ? '<div class="role-badge vice">VC</div>' : '';
            const homeIndicator = player.was_home ? 'home' : 'away';

            return `
                <div class="player-card ${roleClass}" data-player='${JSON.stringify(player)}'>
                    ${roleBadge}
                    <div class="player-name">${player.web_name}</div>
                    <div class="team-name">${player.team_name}</div>
                    <div class="fixture">vs ${player.opponent_team_name} <span class="home-indicator ${homeIndicator}"></span></div>
                    <div class="expected-points">${player.expected_points.toFixed(2)}</div>
                </div>
            `;
        }

        // Function to render the team
        function renderTeam(data) {
            const positions = {
                'Goalkeeper': [],
                'Defender': [],
                'Midfielder': [],
                'Forward': []
            };

            // Group players by position
            data.scout_team.forEach(player => {
                positions[player.element_type].push(player);
            });

            // Sort by expected points (descending)
            Object.keys(positions).forEach(position => {
                positions[position].sort((a, b) => b.expected_points - a.expected_points);
            });

            let pitchHTML = '';

            // Render each position
            Object.keys(positions).forEach(position => {
                if (positions[position].length > 0) {
                    const positionClass = position.toLowerCase();
                    const positionName = position === 'Goalkeeper' ? 'Goalkeepers' :
                        position === 'Defender' ? 'Defenders' :
                            position === 'Midfielder' ? 'Midfielders' : 'Forwards';

                    pitchHTML += `
                        <div class="position-label ${positionClass}">${positionName}</div>
                        <div class="formation-line">
                            ${positions[position].map(createPlayerCard).join('')}
                        </div>
                    `;
                }
            });

            document.getElementById('pitch').innerHTML = pitchHTML;
        }

        // Function to calculate and update statistics
        function updateStatistics(data) {
            const totalPoints = data.scout_team.reduce((sum, player) => sum + player.expected_points, 0);
            const playerCount = data.scout_team.length;
            const captain = data.scout_team.find(p => p.role === "captain");
            const vice = data.scout_team.find(p => p.role === "vice");

            document.getElementById('total-points').textContent = totalPoints.toFixed(2);
            document.getElementById('player-count').textContent = playerCount;
            // document.getElementById('captain-points').textContent = captain ? captain.expected_points.toFixed(2) : '-';
            // document.getElementById('vice-points').textContent = vice ? vice.expected_points.toFixed(2) : '-';
        }

        // Function to update header and credits
        function updateHeaderAndCredits(data) {
            document.getElementById('gameweek-info').textContent = `Gameweek ${data.gameweek} • ${data.version}`;
            document.getElementById('credits').textContent = data.credits;
        }

        // Function to show error message
        function showError(message) {
            document.getElementById('pitch').innerHTML = `<div class="error">${message}</div>`;
        }

        // Function to show loading state
        function showLoading(message = 'Loading team data...') {
            document.getElementById('pitch').innerHTML = `<div class="loading">${message}</div>`;
        }

        // Function to load data from JSON file
        async function loadDataFromFile(gameweek) {
            const filePath = `${CONFIG.dataPath}${CONFIG.filePrefix}${gameweek}${CONFIG.fileExtension}`;

            try {
                showLoading(`Loading Gameweek ${gameweek} data...`);

                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`Failed to load ${filePath}: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();

                // Validate data structure
                if (!data.scout_team || !Array.isArray(data.scout_team)) {
                    throw new Error('Invalid data format: missing scout_team array');
                }

                return data;

            } catch (error) {
                console.error('Error loading JSON data:', error);
                throw error;
            }
        }

        // Function to discover available gameweeks
        async function discoverGameweeks() {
            const gameweeks = [];

            for (let gw = 1; gw <= CONFIG.maxGameweeks; gw++) {
                try {
                    const filePath = `${CONFIG.dataPath}${CONFIG.filePrefix}${gw}${CONFIG.fileExtension}`;
                    const response = await fetch(filePath, { method: 'HEAD' });
                    if (response.ok) {
                        gameweeks.push(gw);
                    }
                } catch (error) {
                    // File doesn't exist or can't be accessed, skip it
                    continue;
                }
            }

            return gameweeks;
        }

        // Function to populate gameweek selector
        function populateGameweekSelector(gameweeks) {
            const selector = document.getElementById('gameweek-select');
            selector.innerHTML = '';

            if (gameweeks.length === 0) {
                selector.innerHTML = '<option value="">No gameweeks available</option>';
                return;
            }

            gameweeks.forEach(gw => {
                const option = document.createElement('option');
                option.value = gw;
                option.textContent = `Gameweek ${gw}`;
                if (gw === currentGameweek) {
                    option.selected = true;
                }
                selector.appendChild(option);
            });
        }

        // Function to handle gameweek selection change
        async function handleGameweekChange(gameweek) {
            if (!gameweek || gameweek === currentGameweek) return;

            currentGameweek = parseInt(gameweek);
            await loadAndDisplayData(currentGameweek);
        }

        // Function to load and display data for a specific gameweek
        async function loadAndDisplayData(gameweek) {
            try {
                const data = await loadDataFromFile(gameweek);
                renderTeam(data);
                updateStatistics(data);
                updateHeaderAndCredits(data);
            } catch (error) {
                showError(`
                    <strong>Error loading Gameweek ${gameweek} data</strong><br>
                    ${error.message}<br><br>
                    <small>Make sure the file <code>${CONFIG.dataPath}${CONFIG.filePrefix}${gameweek}${CONFIG.fileExtension}</code> exists and is accessible.</small>
                `);
            }
        }

        // Screenshot functionality
        async function takeScreenshot() {
            const button = document.getElementById('screenshot-btn');
            const container = document.querySelector('.container');

            try {
                // Disable button and show loading state
                button.disabled = true;
                button.textContent = '📸 Capturing...';

                // Wait a bit for UI to update
                await new Promise(resolve => setTimeout(resolve, 100));

                // Scroll to top to ensure proper positioning
                window.scrollTo(0, 0);

                // Get container position relative to viewport
                const rect = container.getBoundingClientRect();

                // Configure html2canvas options with proper positioning
                const options = {
                    backgroundColor: '#667eea',
                    scale: 2, // Higher quality
                    useCORS: true,
                    allowTaint: true,
                    logging: false,
                    width: container.offsetWidth,
                    height: container.offsetHeight,
                    x: 0,
                    y: 0,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: window.innerWidth,
                    windowHeight: window.innerHeight
                };

                // Capture the screenshot of just the container
                const canvas = await html2canvas(container, options);

                // Create download link
                const link = document.createElement('a');
                link.download = `FPL-Scout-Team-GW${currentGameweek}-${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);

                // Trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // Show success feedback
                button.textContent = '✅ Downloaded!';
                setTimeout(() => {
                    button.textContent = '📸 Screenshot';
                    button.disabled = false;
                }, 2000);

            } catch (error) {
                console.error('Screenshot failed:', error);
                button.textContent = '❌ Failed';
                setTimeout(() => {
                    button.textContent = '📸 Screenshot';
                    button.disabled = false;
                }, 2000);

                // Fallback: try to open print dialog
                window.print();
            }
        }

        // Alternative screenshot function for mobile/unsupported browsers
        function fallbackScreenshot() {
            alert('Screenshot feature not supported. Please use your device\'s built-in screenshot function or print the page.');
        }

        // Check if html2canvas is available, otherwise use fallback
        function initScreenshotFeature() {
            if (typeof html2canvas === 'undefined') {
                document.getElementById('screenshot-btn').onclick = fallbackScreenshot;
                console.warn('html2canvas not loaded, using fallback screenshot method');
            }
        }

        // Function to add interactivity
        function addInteractivity() {
            document.addEventListener('click', function (e) {
                const playerCard = e.target.closest('.player-card');
                if (playerCard) {
                    const playerData = JSON.parse(playerCard.dataset.player);
                    const message = `
                        Player: ${playerData.web_name}
                        Team: ${playerData.team_name}
                        Position: ${playerData.element_type}
                        Fixture: ${playerData.team_name} vs ${playerData.opponent_team_name} (${playerData.was_home ? 'Home' : 'Away'})
                        Expected Points: ${playerData.expected_points.toFixed(2)}
                        ${playerData.role ? `Role: ${playerData.role.charAt(0).toUpperCase() + playerData.role.slice(1)}` : ''}
                    `;
                    alert(message);
                }
            });

            // Add gameweek selector change handler
            document.getElementById('gameweek-select').addEventListener('change', function (e) {
                handleGameweekChange(e.target.value);
            });
        }

        // Initialize the application
        async function init() {
            try {
                // Add interactivity first
                addInteractivity();

                // Initialize screenshot feature
                initScreenshotFeature();

                // Discover available gameweeks
                showLoading('Discovering available gameweeks...');
                availableGameweeks = await discoverGameweeks();

                if (availableGameweeks.length === 0) {
                    showError(`
                        <strong>No gameweek data found</strong><br>
                        Please ensure JSON files exist in the <code>${CONFIG.dataPath}</code> directory<br>
                        Expected format: <code>${CONFIG.filePrefix}1${CONFIG.fileExtension}</code>, <code>${CONFIG.filePrefix}2${CONFIG.fileExtension}</code>, etc.
                    `);
                    return;
                }

                // Set current gameweek to the latest available if default is not available
                if (!availableGameweeks.includes(currentGameweek)) {
                    currentGameweek = Math.max(...availableGameweeks);
                }

                // Populate gameweek selector
                populateGameweekSelector(availableGameweeks);

                // Load and display data for current gameweek
                await loadAndDisplayData(currentGameweek);

            } catch (error) {
                console.error('Error initializing application:', error);
                showError(`
                    <strong>Failed to initialize application</strong><br>
                    ${error.message}<br><br>
                    <small>Please check the console for more details.</small>
                `);
            }
        }

        // Start the application when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>
